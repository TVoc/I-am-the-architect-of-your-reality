\section{Overview}\label{sec:overview}
\subsection{Architectural decisions}

\paragraph{Av1a and Av2a\@: notification of the eDocs Administrator}
\emph{Av1a} and \emph{Av2a} expect a system for notifying the eDocs Administrator of errors within 1 minute. For this purpose, there is a \texttt{Communication Subsystem}, capable of swiftly relaying Error Notifications to the eDocs Administrator. The \texttt{Subsystem} is also responsible for relaying normal message (non-internal errors, standard email deliveries etc.), but this responsibility can be inhibited if system errors are reported, so they take precedence.\\
\emph{Employed tactics and patterns: None}
    
\paragraph{Av1b\@: storing the status of an individual job}
A general \texttt{Job Storage Subsystem} is introduced to the system, to store among others the status of all jobs. For \emph{Av1b}, the \texttt{GeneratorManager} has access to this \texttt{Subsystem}, to change the status of a failed job to ``Temporarily failed''.\\
\emph{Employed tactics and patterns: None}
    
\paragraph{Av2b\@: temporary storage of Personal Document Store documents} \emph{Av2b} specifies that the system should be able to temporarily store three hours of documents should the Personal Document Store fail and furthermore that a maximally functional user interface that clearly indicates that the Personal Document Store is down should be presented. To tackle the first of these requirements, we institute a \texttt{PDSCache} in the \texttt{DocumentStorageHandler} (which is a subcomponent of the \texttt{DocumentDB}, in turn). To fulfil the second, the \texttt{LookupSubsystem} keeps pinging the \texttt{PDSDB}, answering any lookup queries with a message that the Personal Document Store is not available until the ping succeeds. For more details, we refer to section \todo{Av2b label}\\
\emph{Employed tactics and patterns: buffer, ping.}
    
\paragraph{Av3\@: Zoomit failure} \emph{Av3} specifies (1) that the system should be able to detect when an invoice is not accepted by Zoomit (2) that the system should retry several times before taking other measures (3) notify the eDocs administrators of this failure and (4) store at least two days of documents to be delivered via Zoomit. To handle (1) and (2), the \texttt{ZoomitDeliveryHandler} should be implemented appropriately. In order to fulfil (3), the \texttt{ZoomitDeliveryHandler} has access to messaging facilities in the \texttt{CommunicationSubsystem}. To tackle (4), the \texttt{ZoomitDocumentLinkCache} is introduced that stores \texttt{JobID}s of documents to be delivered via Zoomit. For more details, we refer to section \todo{Av3 label}\\
\emph{Employed tactics and patterns: buffer.}
    
\paragraph{P2\@: document lookups}
For handling Document Lookups in a timely fashion, a \texttt{Lookup Subsystem} has been introduced to the system. This \texttt{Subsystem} handles both PDS and Download lookups, monitoring the amount of requests for both sides. When one side is in danger performance-wise because of the other, the \texttt{Subsystem} will throttle the overactive side, so the system keeps performing as expected for both Download and PDS lookups. Enough redundancy in the form of \emph{active replication} is provided in the \texttt{Storage Subsystem} such that lookups and storage of generated documents can be executed simultaneously without having a large impact upon one another.\\
\emph{Employed tactics and patterns: Active replication, Manage event rate}
    
\paragraph{P3\@: status overview for Customer Administrators} \emph{P3} specifies that Customer Administrators should be able to retrieve the status of all documents in a timely fashion. Furthermore, retrieval of this status should have as low an impact as possible on the rest of the system. In view of this, the \texttt{JobStorageSubsystem} has a subcomponent dedicated to storing the status of all jobs, the \texttt{JobStatusDatabase}. In this database, we have applied active replication in order to speed up any reads. \emph{P3} requires that the resulting view be consistent up to one minute ago; we assume that active replication is no obstacle to that. For more details, we refer to section \todo{P3 label}\\
\emph{Employed tactics and patterns: Increase available resources, active replication.}
    
\paragraph{M1\@: New type of document - bank statements} \emph{M1} requires that the addition of bank statements as new document type to the system be as convenient as possible. The most important consideration is that the system should support specifying new templates for the new document type, since generation consists of filling out the fields contained in the template. In other parts of the system, we ensured that behaviour is not coupled too tightly to the type of a specific document. For more details, we refer to section \todo{M1 label}\\
\emph{Employed tactics and patterns: Hide information, generalize module.}
    
\paragraph{M2\@: Multiple print \& postal services} 
In the \texttt{Delivery Subsystem}, the different delivery channels are viewed as black boxes for delivery. They manage their own delivery, billing and job status management where necessary. The delivery channel for postal delivery is the only part of the system to be modified for this requirement. The delivery channel could have a set of possible PPS companies of which to select the desired one. The selection of the desired company could be an extra field in the delivery metadata, while no extra information warrants the default PPS company.\\
\emph{Employed tactics and patterns: Maintain existing interface, Abstract common services}
    
\paragraph{M3\@: Dynamic selection of the cheapest of print \& postal services}
Cfr. \emph{M2}, the postal delivery channel can be modified without changing the rest of the system. This delivery channel can then internally analyse the cost for the delivery of a document, based on the delivery address and set of PPS companies available.\\
\emph{Employed tactics and patterns: Abstract common services}

\subsection{Discussion}
The proposed architecture is quite robust in the imposed specifications, both functional and non-functional. Requirements with high priorities are tackled in a more detailed way, but all requirements have been addressed in the proposed architecture. There are still some abstractions made, e.g. the internal workings of the \texttt{RawDataVerifier} or the \texttt{AuthenticationManager}. Extra attention should be paid to these components at implementation time.\\
The initial division of the system into subsystem with specialised responsibilities keeps a strict separation of concerns in place. This makes for a very suitable system for \emph{Modifiability scenarios}.\\
The system has some bottlenecks for performance, e.g. the \texttt{GeneratedDocumentHandler}, it being a gateway through which all generated documents must pass. Another weak point of the system is that availability approaches to important databases only are applied as dictated by the \emph{Availability scenarios}. The system would be a lot less prone to failure when tactics like replication are applied everywhere where sensible. The latter falls outside the scope of this project.