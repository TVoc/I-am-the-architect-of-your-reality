\section{Overview}\label{sec:overview}
\subsection{Architectural decisions}

\paragraph{Av1a and Av2a: notification of the eDocs Administrator}
\emph{Av1a} and \emph{Av2a} expect a system for notifying the eDocs Administrator of errors within 1 minute. For this purpose, there is a \texttt{CommunicationSubsystem}, capable of swiftly relaying Error Notifications to the eDocs Administrator. The \texttt{Subsystem} is also responsible for relaying standard messages (non-internal errors, standard email deliveries etc.). The delivery of standard messages can be inhibited if system errors are reported, so they take precedence. For more details, we refer to section \ref{march:av1a-av2a}.\\
\emph{Employed tactics and patterns: None}
    
\paragraph{Av1b: storing the status of an individual job}
A general \texttt{JobStorageSubsystem} is introduced to the system, to store among others the status of all jobs. For \emph{Av1b}, the \texttt{GeneratorManager} has access to this \texttt{Subsystem}, to change the status of a failed job to ``Temporarily failed''. For more details, we refer to section \ref{march:av1b}.\\
\emph{Employed tactics and patterns: None}
    
\paragraph{Av2b: temporary storage of Personal Document Store documents} \emph{Av2b} specifies that the system should be able to temporarily store three hours of documents should the Personal Document Store fail. Furthermore, a maximally functional user interface, clearly indicating that the Personal Document Store is down, should be presented. The \ttt{DocumentStorageSubsystem} provides a cache for document IDs in this case. To fulfill the second requirement, the \texttt{LookupSubsystem} will answer a lookup request with a message that the PDS is not available, which the session of the user can interpret and show. For more details, we refer to section \ref{march:av2b}.\\
\emph{Employed tactics and patterns: buffer, ping.}
    
\paragraph{Av3: Zoomit failure} The system should be able to detect when Zoomit does not accept invoices. Measures should be taken to notify the eDocs administrators and to temporarily store two days' worth of invoices. The former is detected in the \ttt{DeliverySubsystem} itself, when trying a Zoomit delivery. A notification is then supplied to the \ttt{CommunicationSubsystem}. The temporary storage of documents happens by recording document IDs inside the \ttt{DeliverySubsystem}, and when Zoomit is reachable again, the \ttt{DocumentStorageSubsystem} will provide these documents and the \ttt{DeliverySubsystem} will again try to deliver them successfully. For more details, we refer to section \ref{march:av3}.\\
\emph{Employed tactics and patterns: buffer.}
    
\paragraph{P2: document lookups}
For handling Document Lookups in a timely fashion, a \texttt{LookupSubsystem} has been introduced to the system. This \texttt{Subsystem} handles both PDS and Download lookups, monitoring the amount of requests for both sides. When one side is in danger performance-wise because of the other, the \texttt{Subsystem} will throttle the overactive side, so the system keeps performing as expected for both Download and PDS lookups. Enough redundancy in the form of \emph{active replication} is provided in the \texttt{StorageSubsystem} such that lookups and storage of generated documents can be executed simultaneously (by the use of sharding) without having a large impact upon one another. For more details, we refer to section \ref{march:p2}.\\
\emph{Employed tactics and patterns: Active replication, Manage event rate, Sharding of databases}
    
\paragraph{P3: status overview for Customer Administrators} \emph{P3} specifies that Customer Administrators should be able to retrieve the status of all documents in a timely fashion. Furthermore, retrieval of this status should have as low an impact as possible on the rest of the system. In view of this, the \texttt{JobStorageSubsystem} contains a dedicated database for storing and querying job statuses. \emph{P3} requires that the resulting view be consistent up to one minute ago. A dedicated database, kept up to date by all necessary parts of the system fulfills this requirement, since near to no delay is present. For more details, we refer to section \ref{march:p3}.\\
\emph{Employed tactics and patterns: Increase available resources, active replication.}
    
\paragraph{M1: New type of document - bank statements} \emph{M1} requires that the addition of bank statements as new document type to the system be as convenient as possible. The most important consideration is that the system should support specifying new templates for the new document type, since generation consists of filling out the fields contained in the template. In other parts of the system, we ensured that behaviour is not coupled too tightly to the type of a specific document, as after generation, there is no need to separate different types of documents. For more details, we refer to section \ref{march:m1}.\\
\emph{Employed tactics and patterns: Hide information, Use an Intermediary}
    
\paragraph{M2: Multiple print \& postal services} 
In the \texttt{DeliverySubsystem}, the different delivery channels are viewed as black boxes for delivery, and are governed by a distributor component. They manage their own delivery, billing and job status management where necessary. The delivery channel for postal delivery is the only part of the system to be modified for this requirement. The delivery channel could have a set of possible PPS companies of which to select the desired one. The selection of the desired company could be an extra field in the delivery metadata, while no extra information warrants the default PPS company. For more details, we refer to section \ref{march:m2}.\\
\emph{Employed tactics and patterns: Hide Information, Use an Intermediary, Abstract common services}
    
\paragraph{M3: Dynamic selection of the cheapest of print \& postal services}
Cfr. \emph{M2}, the postal delivery channel can be modified without changing the rest of the system. This delivery channel can then internally analyse the cost for the delivery of a document, based on the delivery address and set of PPS companies available. For more details, we refer to section \ref{march:m3}.\\
\emph{Employed tactics and patterns: Hide Information, Use an Intermediary, Abstract common services}

\subsection{Discussion}
The proposed architecture is quite robust in the imposed specifications, both functional and non-functional. Requirements with high priorities are tackled in a more detailed way, but all requirements have been addressed in the proposed architecture. There are still some abstractions made, e.g. the internal workings of the \texttt{RawDataVerifier} or the \texttt{AuthenticationManager}. Extra attention should be paid to these components at implementation time.\\
The initial division of the system into subsystems with specialised responsibilities keeps a strict separation of concerns in place. This makes for a very suitable system for \emph{Modifiability scenarios}.\\
The system has some bottlenecks for performance, e.g. the \texttt{GeneratedDocumentHandler}, it being a gateway through which all generated documents must pass. Another weak point of the system is that availability approaches to important databases and functionality only are applied as dictated by the \emph{Availability scenarios}. The system would be a lot less prone to failure when tactics like replication are applied everywhere where sensible, e.g. also in databases without an associated availability scenario. The latter falls outside the scope of this project.\\
It should be noted that the system is very detailed concerning different databases, without being warranted by the non-functional requirements. This makes for a more detailed system than desired, and presents some advantages and disadvantages.\\
The advantages present themselves in the form of more modularity in the system. When modifications have to be made to certain databases or behaviour, the system can mostly be modified locally, without much of a ripple effect. This makes the system also more cohesive, and easier to directly implement. Disadvantages are the need for more infrastructure, since a lot of databases have to exist concurrently, which can be partly mitigated by deploying similar logical databases physically together. It makes for a more complex system, and when radical changes are made to the requirements, larger changes to the system may be warranted.
